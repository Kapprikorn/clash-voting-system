<div class="container mt-4">
  <h2>League of Legends Champion Voting</h2>

  @if (currentSessionId) {
    <div class="alert alert-info">
      <strong>Current Session:</strong> {{ currentSessionId }}
    </div>
  }

  <app-login (adminStatusChange)="onAdminStatusChange($event)" />

  <!-- Login Required Message -->
  @if (!currentUser) {
    <div class="alert alert-warning mt-4">
      <i class="fas fa-sign-in-alt"></i> Please sign in to vote and participate in the poll!
    </div>
  }

  <!-- User Vote Summary -->
  @if (currentUser && getUserVoteCount() > 0) {
    <div class="alert alert-success mt-4">
      <i class="fas fa-check-circle"></i> You have voted for <strong>{{ getUserVoteCount() }}</strong> champion(s).
                                          You can vote once per champion!
    </div>
  }

  <!-- Admin Controls -->
  @if (isAdmin) {
    <div class="card mt-4 border-warning">
      <div class="card-header bg-warning">
        <h5>Admin Controls</h5>
      </div>
      <div class="card-body">
        <button
          class="btn btn-danger"
          (click)="clearAllChampions()"
          [disabled]="isLoading">
          Start New Session (Archive Current)
        </button>
        <small class="form-text text-muted">
          This will create a new voting session and archive the current one.
        </small>
      </div>
    </div>
  }

  <!-- Add Champion -->
  @if (isAdmin) {
    <div class="card mt-4">
      <div class="card-header">
        <h4>Add New Champion</h4>
      </div>
      <div class="card-body">
        <form (ngSubmit)="addChampion()" #championForm="ngForm">
          <div class="mb-3">
            <label for="championName" class="form-label">Champion Name</label>
            <select
              id="championName"
              class="form-select"
              [(ngModel)]="championName"
              name="championName"
              required
              [disabled]="isLoading || availableChampions.length === 0">

              <option value="" disabled>
                @if (availableChampions.length === 0) {
                  Loading champions...
                } @else {
                  Select a champion
                }
              </option>

              @for (championName of availableChampions; track championName) {
                <option [value]="championName.name">{{ championName.name }}</option>
              }
            </select>

            @if (availableChampions.length === 0) {
              <small class="form-text text-muted">
                <i class="fas fa-spinner fa-spin"></i> Loading champion list from League of Legends API...
              </small>
            }
          </div>

          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading || !championName || availableChampions.length === 0">
            @if (isLoading) {
              <span class="spinner-border spinner-border-sm me-2" role="status">
              <span class="visually-hidden">Loading...</span>
            </span>
            }
            {{ isLoading ? 'Adding...' : 'Add Champion' }}
          </button>
        </form>

        <!-- Success Message -->
        @if (successMessage) {
          <div class="alert alert-success mt-3" role="alert">
            {{ successMessage }}
          </div>
        }

        <!-- Error Message -->
        @if (errorMessage) {
          <div class="alert alert-danger mt-3" role="alert">
            {{ errorMessage }}
          </div>
        }
      </div>
    </div>
  }

  <!-- Voting Section -->
  @if (champions.length > 0) {
    <div class="card mt-4">
      <div class="card-header">
        <h4>Vote for Champions ({{ champions.length }} available)</h4>
        <p class="mb-0 text-muted">You can vote once per champion. Click vote again to remove your vote.</p>
      </div>
      <div class="card-body">
        <div class="row">
          @for (champion of champions; track champion.id) {
            <app-vote-details
              [champion]="champion"
              [sessionId]="currentSessionId"
              [user]="currentUser"
            />
          }
        </div>

        <!-- Rest of your voting statistics section remains the same -->
        <app-voting-statistics [champions]="champions" [user]="currentUser" />
      </div>
    </div>
  } @else {
    <div class="card mt-4">
      <div class="card-body text-center">
        <h5>No Champions Available</h5>
        <p class="text-muted">Ask an admin to add some champions to start voting!</p>
      </div>
    </div>
  }
</div>
